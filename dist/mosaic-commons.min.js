/* 
 * mosaic-commons v0.0.9 | License: MIT 
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("underscore"),require("events"),require("when")):"function"==typeof define&&define.amd?define(["underscore","events","when"],b):"object"==typeof exports?exports["mosaic-commons"]=b(require("underscore"),require("events"),require("when")):a["mosaic-commons"]=b(a.underscore,a.events,a.when)}(this,function(a,b,c){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){a.exports=c(1),c(2),c(3),c(4),c(5)},function(a){a.exports={}},function(a,b,c){function d(a,b){for(var c in b)l.has(b,c)&&"prototype"!==c&&(a[c]=b[c])}function e(){var a=this;return j.apply(a,arguments)}function f(a){return a&&a._typeId?this._typeId==a._typeId:!1}function g(a,b){if(!a||!a._typeId)return!1;for(var c=!1,d=b?this:this.parent;!c&&d&&void 0!==d._typeId;d=d.parent)c=d._typeId==a._typeId;return c}function h(a){var b=this["class"];return g.call(b,a,!0)}function i(a){return a?h.call(a,this):!1}function j(){function a(){this.initialize&&this.initialize.apply(this,arguments)}return a.extend=e,a.isSameType=f,a.isSubtype=g,a.hasInstance=i,this&&(d(a,this),d(a.prototype,this.prototype),a.parent=this),l.each(arguments,function(b){d(a.prototype,b)}),a.prototype.instanceOf=h,a.prototype["class"]=a,a.prototype.getClass=function(){return a},a.prototype.setOptions=function(a){this.options=l.extend({},this.options,a)},a._typeId=m++,a.toString=function(){return"class-"+a._typeId},a}var k=a.exports=c(1),l=c(6),m=0,n=j().extend({});n.parent=null,k.Class=n},function(a,b,c){function d(){var a=d.newError;return a.apply(a,arguments)}function e(a){var b;return a instanceof Error?b=a:(j.isString(a)&&0===a.indexOf("Error: ")&&(a=a.substring("Error: ".length)),b=new Error(a)),j.extend(b,k),b}function f(a){var b=e(a.message);return j.isArray(a.trace)&&(b.stack=a.trace.join("\n")),a.code&&b.code(a.code),a.messageKey&&b.messageKey(a.messageKey),b}function g(a){var b={message:"ERROR"};return a&&(b.message=a+"",b.messageKey=a._messageKey,b.status=a.status||500,j.isArray(a.stack)?b.trace=h(a.stack):j.isString(a.stack)?b.trace=a.stack.split(/[\r\n]+/gim):j.isObject(a)?j.each(j.keys(a),function(c){b[c]=a[c]}):b.trace=[JSON.stringify(a)]),b}function h(a){return a?JSON.parse(JSON.stringify(a)):null}var i=a.exports=c(1),j=c(6);i.Errors=d,j.extend(d,{newError:e,toJSON:g,fromJSON:f});var k={code:function(a){return void 0===a?this.status:(this.status=a,this)},messageKey:function(a){return void 0===a?this._messageKey:(this._messageKey=a,this)}}},function(a,b,c){var d=a.exports=c(1),e=c(7),f=c(6);d.Events=function(){e.EventEmitter.apply(this,arguments)},f.extend(d.Events.prototype,e.EventEmitter.prototype,{fire:e.EventEmitter.prototype.emit}),f.extend(d.Events,{listenTo:function(a,b,c,d){var e=this._listeners=this._listeners||[];d=d||this,a.on(b,c,d),e.push({obj:a,event:b,handler:c,context:d})},stopListening:function(a,b){a?this._listeners=f.filter(this._listeners,function(c){var d=!0,e=c.context||this;return c.obj==a&&(b&&b!=c.event||(c.obj.off(c.event,c.handler,e),d=!1)),d},this):(f.each(this._listeners,function(a){var b=a.context||this;a.obj.off(a.event,a.handler,b)},this),delete this._listeners)},triggerMethod:function(){function a(a,b,c){return c.toUpperCase()}var b=/(^|:)(\w)/gi,c=function(c){var d="on"+c.replace(b,a),e=this[d];return f.isFunction(this.fire)&&this.fire.apply(this,arguments),f.isFunction(e)?e.apply(this,f.tail(arguments)):void 0};return c}()})},function(a,b,c){function d(a,b){return Array.prototype.slice.call(a,b)}function e(){return g.apply(this,arguments)}var f=a.exports=c(1),g=c(8);f.P=e;for(var h=["promise","resolve","reject","defer","join","all","spread"],i=0;i<h.length;i++)e[h[i]]=g[h[i]];e.promise=g.promise||function(){return new e},e.then=g.then||function(){var a=new e;return a.then.apply(a,arguments)},e.fin=function(a,b){return a.then(function(a){return e.then(function(){return b(null,a)}).then(function(){return a})},function(a){return e.then(function(){return b(a)}).then(function(){throw a})})},e.timeout=g.timeout?g.timeout:function(a,b){var c=e.defer(),d=setTimeout(function(){b=b||"Timed out after "+a+" ms",c.reject(new Error(b))},a);return c.promise.then(function(a){return clearTimeout(d),a},function(a){throw clearTimeout(d),a})},e.delay=g.delay||function(a){return a=a||0,e.then(function(b){var c=e.defer(),d=setTimeout(function(){c.resolve(b)},a);return c.promise.cancel=function(){clearTimeout(d),c.resolve(b)},c.promise})},e.nresolver=function(a){return function(b,c){b?a.reject(b):a.resolve(arguments.length>2?d(arguments,1):c)}},e.nwrapper=function(a,b){function c(b){f[b]=function(){var c=e.defer();try{var f=d(arguments);f.push(e.nresolver(c)),a[b].apply(a,f)}catch(g){c.reject(g)}return c.promise}}for(var f={instance:a},g=0;g<b.length;g++)c(b[g]);return f},e.ninvoke=e.ninvoke||function(a,b){var c=d(arguments,2),f=e.defer();c.push(e.nresolver(f));try{a[b].apply(a,c)}catch(g){f.reject(g)}return f.promise},e.nfapply=g.nfapply||function(a,b){var c=e.defer(),f=d(b);f.push(e.nresolver(c));try{a.apply(a,f)}catch(g){c.reject(g)}return c.promise},e.nfcall=g.nfcall||function(a){var b=d(arguments,1);return e.nfapply(a,b)}},function(b){b.exports=a},function(a){a.exports=b},function(a){a.exports=c}])});
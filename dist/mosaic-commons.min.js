/*! mosaic-commons 2014-07-13 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.mosaicCommons=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(){}var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")}},{}],2:[function(b,c){!function(a){"use strict";a(function(a){var b=a("./makePromise"),c=a("./Scheduler"),d=a("./async");return b({scheduler:new c(d)})})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"./Scheduler":4,"./async":6,"./makePromise":16}],3:[function(b,c){!function(a){"use strict";a(function(){function a(a){this.head=this.tail=this.length=0,this.buffer=new Array(1<<a)}return a.prototype.push=function(a){return this.length===this.buffer.length&&this._ensureCapacity(2*this.length),this.buffer[this.tail]=a,this.tail=this.tail+1&this.buffer.length-1,++this.length,this.length},a.prototype.shift=function(){var a=this.buffer[this.head];return this.buffer[this.head]=void 0,this.head=this.head+1&this.buffer.length-1,--this.length,a},a.prototype._ensureCapacity=function(a){var b,c=this.head,d=this.buffer,e=new Array(a),f=0;if(0===c)for(b=this.length;b>f;++f)e[f]=d[f];else{for(a=d.length,b=this.tail;a>c;++f,++c)e[f]=d[c];for(c=0;b>c;++f,++c)e[f]=d[c]}this.buffer=e,this.head=0,this.tail=this.length},a})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],4:[function(b,c){!function(a){"use strict";a(function(a){function b(a){this._async=a,this._queue=new d(15),this._afterQueue=new d(5),this._running=!1;var b=this;this.drain=function(){b._drain()}}function c(a){for(;a.length>0;)a.shift().run()}var d=a("./Queue");return b.prototype.enqueue=function(a){this._add(this._queue,a)},b.prototype.afterQueue=function(a){this._add(this._afterQueue,a)},b.prototype._drain=function(){c(this._queue),this._running=!1,c(this._afterQueue)},b.prototype._add=function(a,b){a.push(b),this._running||(this._running=!0,this._async(this.drain))},b})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"./Queue":3}],5:[function(b,c){!function(a){"use strict";a(function(){function a(b){Error.call(this),this.message=b,this.name=a.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],6:[function(b,c){(function(d){!function(a){"use strict";a(function(a){var b,c;return b="undefined"!=typeof d&&null!==d&&"function"==typeof d.nextTick?function(a){d.nextTick(a)}:(c="function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver)?function(a,b){function c(){var a=d;d=void 0,a()}var d,e=a.createElement("div"),f=new b(c);return f.observe(e,{attributes:!0}),function(a){d=a,e.setAttribute("class","x")}}(document,c):function(a){try{return a("vertx").runOnLoop||a("vertx").runOnContext}catch(b){}var c=setTimeout;return function(a){c(a,0)}}(a)})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})}).call(this,b("JkpR2F"))},{JkpR2F:1}],7:[function(b,c){!function(a){"use strict";a(function(){return function(a){function b(b){return new a(function(a,c){function e(a){f.push(a),0===--g&&c(f)}var f=[],g=d(b,a,e);0===g&&c(new RangeError("any() input must not be empty"))})}function c(b,c){return new a(function(a,e,f){function g(b){l>0&&(--l,j.push(b),0===l&&a(j))}function h(a){i>0&&(--i,k.push(a),0===i&&e(k))}var i,j=[],k=[],l=d(b,g,h,f);c=Math.max(c,0),i=l-c+1,l=Math.min(c,l),c>l?e(new RangeError("some() input must contain at least "+c+" element(s), but had "+l)):0===l&&a(j)})}function d(a,b,c,d){var e=0;return m.call(a,function(a){++e,n(a).then(b,c,d)}),e}function e(a,b,c){return o(j.call(a,function(a){return n(a).then(b,c)}))}function f(a){return o(j.call(a,function(a){function b(){return a.inspect()}return a=n(a),a.then(b,b)}))}function g(a,b){var c=i(b);return arguments.length>2?k.call(a,c,arguments[2]):k.call(a,c)}function h(a,b){var c=i(b);return arguments.length>2?l.call(a,c,arguments[2]):l.call(a,c)}function i(a){return function(b,c,d){return n(b).then(function(b){return n(c).then(function(c){return a(b,c,d)})})}}var j=Array.prototype.map,k=Array.prototype.reduce,l=Array.prototype.reduceRight,m=Array.prototype.forEach,n=a.resolve,o=a.all;return a.any=b,a.some=c,a.settle=f,a.map=e,a.reduce=g,a.reduceRight=h,a.prototype.spread=function(a){return this.then(o).then(function(b){return a.apply(void 0,b)})},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],8:[function(b,c){!function(a){"use strict";a(function(){function a(){throw new TypeError("catch predicate must be a function")}function b(a,b){return c(b)?a instanceof b:b(a)}function c(a){return a===Error||null!=a&&a.prototype instanceof Error}function d(a,b){return function(){return a.call(this),b}}return function(c){function e(a,c){return function(d){return b(d,c)?a.call(this,d):f(d)}}var f=c.reject,g=c.prototype["catch"];return c.prototype.done=function(a,b){this._handler.visit(this._handler.receiver,a,b)},c.prototype["catch"]=c.prototype.otherwise=function(b){return 1===arguments.length?g.call(this,b):"function"!=typeof b?this.ensure(a):g.call(this,e(arguments[1],b))},c.prototype["finally"]=c.prototype.ensure=function(a){return"function"!=typeof a?this:(a=d(a,this),this.then(a,a))},c.prototype["else"]=c.prototype.orElse=function(a){return this.then(void 0,function(){return a})},c.prototype["yield"]=function(a){return this.then(function(){return a})},c.prototype.tap=function(a){return this.then(a)["yield"](this)},c}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],9:[function(b,c){!function(a){"use strict";a(function(){return function(a){return a.prototype.fold=function(b,c){var d=this._beget();return this._handler.fold(function(c,d,e){a._handler(c).fold(function(a,c,d){d.resolve(b.call(this,c,a))},d,this,e)},c,d._handler.receiver,d._handler),d},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],10:[function(b,c){!function(a){"use strict";a(function(){return function(a){return a.prototype.inspect=function(){return this._handler.inspect()},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],11:[function(b,c){!function(a){"use strict";a(function(){return function(a){function b(a,b,d,e){return c(function(b){return[b,a(b)]},b,d,e)}function c(a,b,e,f){function g(f,g){return d(e(f)).then(function(){return c(a,b,e,g)})}return d(f).then(function(c){return d(b(c)).then(function(b){return b?c:d(a(c)).spread(g)})})}var d=a.resolve;return a.iterate=b,a.unfold=c,a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],12:[function(b,c){!function(a){"use strict";a(function(){return function(a){return a.prototype.progress=function(a){return this.then(void 0,void 0,a)},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],13:[function(b,c){!function(a){"use strict";a(function(a){function b(a,b,d,e){return c.set(function(){a(d,e,b)},b)}var c=a("../timer"),d=a("../TimeoutError");return function(a){function e(a,c,d){b(f,a,c,d)}function f(a,b){b.resolve(a)}function g(a,b,c){var e="undefined"==typeof a?new d("timed out after "+c+"ms"):a;b.reject(e)}return a.prototype.delay=function(a){var b=this._beget();return this._handler.fold(e,a,void 0,b._handler),b},a.prototype.timeout=function(a,d){var e=this._beget(),f=e._handler,h=b(g,a,d,e._handler);return this._handler.visit(f,function(a){c.clear(h),this.resolve(a)},function(a){c.clear(h),this.reject(a)},f.notify),e},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"../TimeoutError":5,"../timer":17}],14:[function(b,c){!function(a){"use strict";a(function(a){function b(a){var b="object"==typeof a&&a.stack?a.stack:c(a);return a instanceof Error?b:b+" (WARNING: non-Error used)"}function c(a){var b=String(a);return"[object Object]"===b&&"undefined"!=typeof JSON&&(b=d(a,b)),b}function d(a,b){try{return JSON.stringify(a)}catch(a){return b}}function e(a){throw a}function f(){}var g=a("../timer");return function(a){function d(a){a.handled||(n.push(a),k("Potentially unhandled rejection ["+a.id+"] "+b(a.value)))}function h(a){var b=n.indexOf(a);b>=0&&(n.splice(b,1),l("Handled previous rejection ["+a.id+"] "+c(a.value)))}function i(a,b){m.push(a,b),o||(o=!0,o=g.set(j,0))}function j(){for(o=!1;m.length>0;)m.shift()(m.shift())}var k=f,l=f;"undefined"!=typeof console&&(k="undefined"!=typeof console.error?function(a){console.error(a)}:function(a){console.log(a)},l="undefined"!=typeof console.info?function(a){console.info(a)}:function(a){console.log(a)}),a.onPotentiallyUnhandledRejection=function(a){i(d,a)},a.onPotentiallyUnhandledRejectionHandled=function(a){i(h,a)},a.onFatalRejection=function(a){i(e,a.value)};var m=[],n=[],o=!1;return a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"../timer":17}],15:[function(b,c){!function(a){"use strict";a(function(){return function(a){return a.prototype["with"]=a.prototype.withThis=a.prototype._bindContext,a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],16:[function(b,c){!function(a){"use strict";a(function(){return function(a){function b(a,b){this._handler=a===l?b:c(a)}function c(a){function b(a){e.resolve(a)}function c(a){e.reject(a)}function d(a){e.notify(a)}var e=new n;try{a(b,c,d)}catch(f){c(f)}return e}function d(a){return C(a)?a:new b(l,new p(j(a)))}function e(a){return new b(l,new p(new t(a)))}function f(){return R}function g(){return new b(l,new n)}function h(a){function c(a,b,c){this[a]=b,0===--i&&c.become(new s(this))}var d,e,f,g,h=new n,i=a.length>>>0,j=new Array(i);for(d=0;d<a.length;++d)if(f=a[d],void 0!==f||d in a)if(D(f))if(e=C(f)?f._handler.join():k(f),g=e.state(),0===g)e.fold(c,d,j,h);else{if(!(g>0)){h.become(e);break}j[d]=e.value,--i}else j[d]=f,--i;else--i;return 0===i&&h.become(new s(j)),new b(l,h)}function i(a){if(Object(a)===a&&0===a.length)return f();var c,d,e=new n;for(c=0;c<a.length;++c)d=a[c],void 0!==d&&c in a&&j(d).visit(e,e.resolve,e.reject);return new b(l,e)}function j(a){return C(a)?a._handler.join():D(a)?k(a):new s(a)}function k(a){try{var b=a.then;return"function"==typeof b?new r(b,a):new s(a)}catch(c){return new t(c)}}function l(){}function m(){}function n(a,c){b.createContext(this,c),this.consumers=void 0,this.receiver=a,this.handler=void 0,this.resolved=!1}function o(a){this.handler=a}function p(a){o.call(this,a)}function q(a,b){o.call(this,a),this.receiver=b}function r(a,b){n.call(this),M.enqueue(new A(a,b,this))}function s(a){b.createContext(this),this.value=a}function t(a){b.createContext(this),this.id=++P,this.value=a,this.handled=!1,this.reported=!1,this._report()}function u(a,b){this.rejection=a,this.context=b}function v(a){this.rejection=a}function w(){return new t(new TypeError("Promise cycle"))}function x(){return{state:"pending"}}function y(a,b){this.continuation=a,this.handler=b}function z(a,b){this.handler=b,this.value=a}function A(a,b,c){this._then=a,this.thenable=b,this.resolver=c}function B(a,b,c,d,e){try{a.call(b,c,d,e)}catch(f){d(f)}}function C(a){return a instanceof b}function D(a){return("object"==typeof a||"function"==typeof a)&&null!==a}function E(a,c,d,e){return"function"!=typeof a?e.become(c):(b.enterContext(c),H(a,c.value,d,e),void b.exitContext())}function F(a,c,d,e,f){return"function"!=typeof a?f.become(d):(b.enterContext(d),I(a,c,d.value,e,f),void b.exitContext())}function G(a,c,d,e,f){return"function"!=typeof a?f.notify(c):(b.enterContext(d),J(a,c,e,f),void b.exitContext())}function H(a,b,c,d){try{d.become(j(a.call(c,b)))}catch(e){d.become(new t(e))}}function I(a,b,c,d,e){try{a.call(d,b,c,e)}catch(f){e.become(new t(f))}}function J(a,b,c,d){try{d.notify(a.call(c,b))}catch(e){d.notify(e)}}function K(a,b){b.prototype=N(a.prototype),b.prototype.constructor=b}function L(){}var M=a.scheduler,N=Object.create||function(a){function b(){}return b.prototype=a,new b};b.resolve=d,b.reject=e,b.never=f,b._defer=g,b._handler=j,b.prototype.then=function(a,c){var d=this._handler;if("function"!=typeof a&&d.join().state()>0)return new b(l,d);var e=this._beget(),f=e._handler;return d.chain(f,d.receiver,a,c,arguments.length>2?arguments[2]:void 0),e},b.prototype["catch"]=function(a){return this.then(void 0,a)},b.prototype._bindContext=function(a){return new b(l,new q(this._handler,a))},b.prototype._beget=function(){var a=this._handler,b=new n(a.receiver,a.join().context);return new this.constructor(l,b)},b.all=h,b.race=i,l.prototype.when=l.prototype.become=l.prototype.notify=l.prototype.fail=l.prototype._unreport=l.prototype._report=L,l.prototype.inspect=x,l.prototype._state=0,l.prototype.state=function(){return this._state},l.prototype.join=function(){for(var a=this;void 0!==a.handler;)a=a.handler;return a},l.prototype.chain=function(a,b,c,d,e){this.when({resolver:a,receiver:b,fulfilled:c,rejected:d,progress:e})},l.prototype.visit=function(a,b,c,d){this.chain(O,a,b,c,d)},l.prototype.fold=function(a,b,c,d){this.visit(d,function(d){a.call(c,b,d,this)},d.reject,d.notify)},K(l,m),m.prototype.become=function(a){a.fail()};var O=new m;K(l,n),n.prototype._state=0,n.prototype.inspect=function(){return this.resolved?this.join().inspect():x()},n.prototype.resolve=function(a){this.become(j(a))},n.prototype.reject=function(a){this.resolved||this.become(new t(a))},n.prototype.join=function(){if(!this.resolved)return this;for(var a=this;void 0!==a.handler;)if(a=a.handler,a===this)return this.handler=w();return a},n.prototype.run=function(){var a=this.consumers,b=this.join();this.consumers=void 0;for(var c=0;c<a.length;++c)b.when(a[c])},n.prototype.become=function(a){this.resolved||(this.resolved=!0,this.handler=a,void 0!==this.consumers&&M.enqueue(this),void 0!==this.context&&a._report(this.context))},n.prototype.when=function(a){this.resolved?M.enqueue(new y(a,this.handler)):void 0===this.consumers?this.consumers=[a]:this.consumers.push(a)},n.prototype.notify=function(a){this.resolved||M.enqueue(new z(a,this))},n.prototype.fail=function(a){var b="undefined"==typeof a?this.context:a;this.resolved&&this.handler.join().fail(b)},n.prototype._report=function(a){this.resolved&&this.handler.join()._report(a)},n.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},K(l,o),o.prototype.inspect=function(){return this.join().inspect()},o.prototype._report=function(a){this.join()._report(a)},o.prototype._unreport=function(){this.join()._unreport()},K(o,p),p.prototype.when=function(a){M.enqueue(new y(a,this))},K(o,q),q.prototype.when=function(a){void 0!==this.receiver&&(a.receiver=this.receiver),this.join().when(a)},K(n,r),K(l,s),s.prototype._state=1,s.prototype.inspect=function(){return{state:"fulfilled",value:this.value}},s.prototype.fold=function(a,b,c,d){F(a,b,this,c,d)},s.prototype.when=function(a){E(a.fulfilled,this,a.receiver,a.resolver)};var P=0;K(l,t),t.prototype._state=-1,t.prototype.inspect=function(){return{state:"rejected",reason:this.value}},t.prototype.fold=function(a,b,c,d){this._unreport(),d.become(this)},t.prototype.when=function(a){this._unreport(),E(a.rejected,this,a.receiver,a.resolver)},t.prototype._report=function(a){M.afterQueue(new u(this,a))},t.prototype._unreport=function(){this.handled=!0,M.afterQueue(new v(this))},t.prototype.fail=function(a){b.onFatalRejection(this,void 0===a?this.context:a)},u.prototype.run=function(){this.rejection.handled||(this.rejection.reported=!0,b.onPotentiallyUnhandledRejection(this.rejection,this.context))},v.prototype.run=function(){this.rejection.reported&&b.onPotentiallyUnhandledRejectionHandled(this.rejection)},b.createContext=b.enterContext=b.exitContext=b.onPotentiallyUnhandledRejection=b.onPotentiallyUnhandledRejectionHandled=b.onFatalRejection=L;var Q=new l,R=new b(l,Q);return y.prototype.run=function(){this.handler.join().when(this.continuation)},z.prototype.run=function(){var a=this.handler.consumers;if(void 0!==a)for(var b,c=0;c<a.length;++c)b=a[c],G(b.progress,this.value,this.handler,b.receiver,b.resolver)},A.prototype.run=function(){function a(a){d.resolve(a)}function b(a){d.reject(a)}function c(a){d.notify(a)}var d=this.resolver;B(this._then,this.thenable,a,b,c)},b}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],17:[function(b,c){!function(a){"use strict";a(function(a){var b,c,d,e;b=a;try{c=b("vertx"),d=function(a,b){return c.setTimer(b,a)},e=c.cancelTimer}catch(f){d=function(a,b){return setTimeout(a,b)},e=function(a){return clearTimeout(a)}}return{set:d,clear:e}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{}],18:[function(b,c){!function(a){"use strict";a(function(a){function b(a,b,c){var d=z.resolve(a);return arguments.length<2?d:arguments.length>3?d.then(b,c,arguments[3]):d.then(b,c)}function c(a){return new z(a)}function d(a){return function(){return f(a,this,A.call(arguments))}}function e(a){return f(a,this,A.call(arguments,1))}function f(a,b,c){return z.all(c).then(function(c){return a.apply(b,c)})}function g(){return new h}function h(){function a(a){d._handler.resolve(a)}function b(a){d._handler.reject(a)}function c(a){d._handler.notify(a)}var d=z._defer();this.promise=d,this.resolve=a,this.reject=b,this.notify=c,this.resolver={resolve:a,reject:b,notify:c}}function i(a){return a&&"function"==typeof a.then}function j(){return z.all(arguments)}function k(a){return b(a,z.all)}function l(a){return b(a,z.settle)}function m(a,c){return b(a,function(a){return z.map(a,c)})}function n(a){var c=A.call(arguments,1);return b(a,function(a){return c.unshift(a),z.reduce.apply(z,c)})}function o(a){var c=A.call(arguments,1);return b(a,function(a){return c.unshift(a),z.reduceRight.apply(z,c)})}var p=a("./lib/decorators/timed"),q=a("./lib/decorators/array"),r=a("./lib/decorators/flow"),s=a("./lib/decorators/fold"),t=a("./lib/decorators/inspect"),u=a("./lib/decorators/iterate"),v=a("./lib/decorators/progress"),w=a("./lib/decorators/with"),x=a("./lib/decorators/unhandledRejection"),y=a("./lib/TimeoutError"),z=[q,r,s,u,v,t,w,p,x].reduce(function(a,b){return b(a)},a("./lib/Promise")),A=Array.prototype.slice;return b.promise=c,b.resolve=z.resolve,b.reject=z.reject,b.lift=d,b["try"]=e,b.attempt=e,b.iterate=z.iterate,b.unfold=z.unfold,b.join=j,b.all=k,b.settle=l,b.any=d(z.any),b.some=d(z.some),b.race=d(z.race),b.map=m,b.reduce=n,b.reduceRight=o,b.isPromiseLike=i,b.Promise=z,b.defer=g,b.TimeoutError=y,b})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"./lib/Promise":2,"./lib/TimeoutError":5,"./lib/decorators/array":7,"./lib/decorators/flow":8,"./lib/decorators/fold":9,"./lib/decorators/inspect":10,"./lib/decorators/iterate":11,"./lib/decorators/progress":12,"./lib/decorators/timed":13,"./lib/decorators/unhandledRejection":14,"./lib/decorators/with":15}],19:[function(a,b){(function(c){!function(a,d){function e(a,b){for(var c in b)m.has(b,c)&&"prototype"!==c&&(a[c]=b[c])}function f(){var a=this;return k.apply(a,arguments)}function g(a){return a&&a._typeId?this._typeId==a._typeId:!1}function h(a,b){if(!a||!a._typeId)return!1;for(var c=!1,d=b?this:this.parent;!c&&d&&void 0!==d._typeId;d=d.parent)c=d._typeId==a._typeId;return c}function i(a){var b=this["class"];return h.call(b,a,!0)}function j(a){return a?i.call(a,this):!1}function k(){function a(){this.initialize&&this.initialize.apply(this,arguments)}return a.extend=f,a.isSameType=g,a.isSubtype=h,a.hasInstance=j,this&&(e(a,this),e(a.prototype,this.prototype),a.parent=this),m.each(arguments,function(b){e(a.prototype,b)}),a.prototype.instanceOf=i,a.prototype["class"]=a,a.prototype.getClass=function(){return a},a.prototype.setOptions=function(a){this.options=m.extend({},this.options,a)},a._typeId=n++,a.toString=function(){return"class-"+a._typeId},a}var l=b.exports=d("./Mosaic"),m="undefined"!=typeof window?window.Mosaic.libs.underscore:"undefined"!=typeof c?c.Mosaic.libs.underscore:null,n=0,o=k();l.Class=o}(this,a)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Mosaic":22}],20:[function(a,b){(function(c){!function(a,d){"use strict";function e(){var a=e.newError;return a.apply(a,arguments)}function f(a){var b;return a instanceof Error?b=a:(k.isString(a)&&0===a.indexOf("Error: ")&&(a=a.substring("Error: ".length)),b=new Error(a)),k.extend(b,l),b}function g(a){var b=f(a.message);return k.isArray(a.trace)&&(b.stack=a.trace.join("\n")),a.code&&b.code(a.code),a.messageKey&&b.messageKey(a.messageKey),b}function h(a){var b={message:"ERROR"};return a&&(b.message=a+"",b.messageKey=a._messageKey,b.status=a.status||500,k.isArray(a.stack)?b.trace=i(a.stack):k.isString(a.stack)?b.trace=a.stack.split(/[\r\n]+/gim):k.isObject(a)?k.each(k.keys(a),function(c){b[c]=a[c]}):b.trace=[JSON.stringify(a)]),b}function i(a){return a?JSON.parse(JSON.stringify(a)):null}var j=b.exports=d("./Mosaic"),k="undefined"!=typeof window?window.Mosaic.libs.underscore:"undefined"!=typeof c?c.Mosaic.libs.underscore:null;j.Errors=e,k.extend(e,{newError:f,toJSON:h,fromJSON:g});var l={code:function(a){return void 0===a?this.status:(this.status=a,this)},messageKey:function(a){return void 0===a?this._messageKey:(this._messageKey=a,this)}};return j}(this,a)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Mosaic":22}],21:[function(a,b){b.exports=function(a){"use strict";function c(a,b){return Array.prototype.slice.call(a,b)}function d(){return f.apply(this,arguments)}var e=b.exports=a("./Mosaic"),f=a("when");e.P=d;for(var g=["promise","resolve","reject","defer","join","all","spread"],h=0;h<g.length;h++)d[g[h]]=f[g[h]];return d.promise=f.promise||function(){return new d},d.then=f.then||function(){var a=new d;return a.then.apply(a,arguments)},d.fin=function(a,b){return a.then(function(a){return d.then(function(){return b(null,a)}).then(function(){return a})},function(a){return d.then(function(){return b(a)}).then(function(){throw a})})},d.timeout=f.timeout?f.timeout:function(a,b){var c=d.defer(),e=setTimeout(function(){b=b||"Timed out after "+a+" ms",c.reject(new Error(b))},a);return c.promise.then(function(a){return clearTimeout(e),a},function(a){throw clearTimeout(e),a})},d.delay=f.delay||function(a){return a=a||0,d.then(function(b){var c=d.defer(),e=setTimeout(function(){c.resolve(b)},a);return c.promise.cancel=function(){clearTimeout(e),c.resolve(b)},c.promise})},d.nresolver=function(a){return function(b,d){b?a.reject(b):a.resolve(arguments.length>2?c(arguments,1):d)}},d.nwrapper=function(a,b){function e(b){f[b]=function(){var e=d.defer();try{var f=c(arguments);f.push(d.nresolver(e)),a[b].apply(a,f)}catch(g){e.reject(g)}return e.promise}}for(var f={instance:a},g=0;g<b.length;g++)e(b[g]);return f},d.ninvoke=d.ninvoke||function(a,b){var e=c(arguments,2),f=d.defer();e.push(d.nresolver(f));try{a[b].apply(a,e)}catch(g){f.reject(g)}return f.promise},d.nfapply=f.nfapply||function(a,b){var e=d.defer(),f=c(b);f.push(d.nresolver(e));try{a.apply(a,f)}catch(g){e.reject(g)}return e.promise},d.nfcall=f.nfcall||function(a){var b=c(arguments,1);return d.nfapply(a,b)},e}(a)},{"./Mosaic":22,when:18}],22:[function(a,b){(function(a){!function(a){"use strict";b.exports=a.Mosaic=a.Mosaic||{}}("undefined"!=typeof window?window:"undefined"!=typeof a?a:null)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],23:[function(a,b){b.exports=a("./Mosaic"),a("./Mosaic.Class"),a("./Mosaic.Errors"),a("./Mosaic.P")},{"./Mosaic":22,"./Mosaic.Class":19,"./Mosaic.Errors":20,"./Mosaic.P":21}]},{},[23])(23)});